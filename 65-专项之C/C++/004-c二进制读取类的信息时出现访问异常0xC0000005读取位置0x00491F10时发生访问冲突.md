

 

       最近再做一个系统时，写了一个基类4个派生类，基类中有虚函数，每次修改之后就将二级制信息存储进*.dat文件。

但是在再起启动程序时就出现这样的访问冲突问题，然后就一直困扰了3天，搜百度，博客，知乎等。最后还是在老师的提醒下发现问题出现在哪里。

      每个类每多一个虚函数，其内存大小就多4个字节用来存放改函数对应的地址，所以在用二进制存取的过程中也将虚函数的地址存入*.dat文件，接下来重启程序时，此时生成程序的虚函数地址可能已经改变，但是在二进制读取时还是读取的原来的函数地址，所以在使用基类时的数据就会出现访问错误，可能会访问位置内存，但没有访问权限，接下来就是程序异常退出。

 


![./figures/20180612194837703](./figures/20180612194837703)


 

 大概就是这样的问题，我试着换了还文本模式读取信息，成功！！！

 

还有需要注意一点的是 new开辟内存时会调用类的构造函数，但是malloc不会，后者只是在栈上非分配指定大小内存而已。

 

