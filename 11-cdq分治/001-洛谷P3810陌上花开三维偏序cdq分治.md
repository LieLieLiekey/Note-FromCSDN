

## 洛谷P3810（陌上花开）（三维偏序，cdq分治）


#### 题目链接：[传送门 ](https://www.luogu.org/problem/P3810)


#### 思路：



PS：cdq是一种思路，因为最早是被陈丹琦引入国内的，所以就叫 cdq 分治了。


本题中的三维偏序可以取等号，所以需要注意（a,b,c）相等的情况。这时不能定义顺序，所以我们记录该元组的数量即可。

对于每个元组，我们先记录严格小于(a,b,c)元组的数量，再加上与之相等元组的数量就是这个小于等于指这个元组答案。

所以我们先将所有元组按a，b，c分别为第一，第二，第三关键字进行从小到大排序。那么对于第i个元组，严格小于这个元素的元组只会在 $i i$ 左边。然后进行cdq分治。

对于区间$[ l , r ] [l,r]$ 的计算，假设区间中点为m，对于每个偏序对i，j分为三种情况。


+ $l ≤ i , j ≤ m l\le i,j\le m$
+ $l ≤ i ≤ m    a n d    m + 1 ≤ j ≤ r ​ l\le i\le m ~~and~~m+1\le j\le r​$
+ $m + 1 ≤ i , j ≤ r ​ m+1\le i,j\le r​$



那么第一种情况的偏序对，我们用$c d q ( l , m ) cdq(l,m)$

